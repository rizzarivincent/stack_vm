refactor the code to use the VM struct

create unit test .c file
unit testing!